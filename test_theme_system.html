<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8è½®ä¸»é¢˜ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .theme-info {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin: 10px 0;
        }
        .scenario-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid #28a745;
        }
        .emotion-tag {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            background: #e9ecef;
            border-radius: 12px;
            font-size: 12px;
        }
        .intensity-high { border-left-color: #dc3545; }
        .intensity-medium { border-left-color: #ffc107; }
        .intensity-low { border-left-color: #28a745; }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .test-pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .test-fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>ğŸ® 8è½®ä¸»é¢˜ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ§åˆ¶é¢æ¿</h2>
        <button onclick="testThemeProgression()">æµ‹è¯•ä¸»é¢˜é€’è¿›ç³»ç»Ÿ</button>
        <button onclick="testScenarioSelection()">æµ‹è¯•åœºæ™¯é€‰æ‹©æœºåˆ¶</button>
        <button onclick="testEmotionMapping()">æµ‹è¯•æƒ…ç»ªçŠ¶æ€æ˜ å°„</button>
        <button onclick="testFallbackMessages()">æµ‹è¯•ä¸»é¢˜åŒ–å¤‡ç”¨æ¶ˆæ¯</button>
        <button onclick="runFullSystemTest()">è¿è¡Œå®Œæ•´ç³»ç»Ÿæµ‹è¯•</button>
        <button onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœè¾“å‡º</h2>
        <div id="output"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ­ 8è½®ä¸»é¢˜æ¦‚è§ˆ</h2>
        <div id="themeOverview"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ åœºæ™¯åº“ç»Ÿè®¡</h2>
        <div id="scenarioStats"></div>
    </div>

    <!-- åŠ è½½æ‰€æœ‰å¿…è¦çš„è„šæœ¬ -->
    <script src="js/config.js"></script>
    <script src="js/ThemeProgression.js"></script>
    <script src="js/ThemeScenarios.js"></script>

    <script>
        // è¾“å‡ºæ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const colorMap = {
                'info': '#333',
                'success': '#28a745',
                'error': '#dc3545',
                'warning': '#ffc107'
            };
            output.innerHTML += `<div style="color: ${colorMap[type]}; margin: 2px 0;">
                [${timestamp}] ${message}
            </div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        // æµ‹è¯•ä¸»é¢˜é€’è¿›ç³»ç»Ÿ
        function testThemeProgression() {
            log('ğŸš€ å¼€å§‹æµ‹è¯•ä¸»é¢˜é€’è¿›ç³»ç»Ÿ...', 'info');
            
            try {
                for (let round = 1; round <= 8; round++) {
                    const theme = ThemeUtils.getCurrentTheme(round);
                    
                    if (theme) {
                        log(`âœ… ç¬¬${round}è½® - ${theme.title} (${theme.id})`, 'success');
                        log(`   æè¿°: ${theme.description}`, 'info');
                        log(`   éš¾åº¦: ${theme.difficulty}, é€šè¿‡ç‡: ${theme.passRate}`, 'info');
                        log(`   æƒ…ç»ªåŸºè°ƒ: ${theme.mood}, è‰²å½©: ${theme.color}`, 'info');
                    } else {
                        log(`âŒ ç¬¬${round}è½®ä¸»é¢˜é…ç½®ç¼ºå¤±`, 'error');
                    }
                }
                log('âœ… ä¸»é¢˜é€’è¿›ç³»ç»Ÿæµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                log(`âŒ ä¸»é¢˜é€’è¿›ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•åœºæ™¯é€‰æ‹©æœºåˆ¶
        function testScenarioSelection() {
            log('ğŸ¯ å¼€å§‹æµ‹è¯•åœºæ™¯é€‰æ‹©æœºåˆ¶...', 'info');
            
            try {
                const themeIds = Object.keys(THEME_SCENARIOS);
                
                for (const themeId of themeIds) {
                    const scenarios = ThemeScenarioManager.getScenariosByTheme(themeId);
                    log(`ğŸ“š ä¸»é¢˜ ${themeId}: å…±${scenarios.length}ä¸ªåœºæ™¯`, 'info');
                    
                    // æµ‹è¯•éšæœºåœºæ™¯è·å–
                    const randomScenario = ThemeScenarioManager.getRandomScenario(themeId);
                    if (randomScenario) {
                        log(`   éšæœºåœºæ™¯: ${randomScenario.description}`, 'info');
                    }
                    
                    // æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯
                    const stats = ThemeScenarioManager.getThemeStats(themeId);
                    log(`   ç»Ÿè®¡: å…±${stats.total}ä¸ªåœºæ™¯, ${stats.categories.length}ä¸ªç±»åˆ«`, 'info');
                }
                log('âœ… åœºæ™¯é€‰æ‹©æœºåˆ¶æµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                log(`âŒ åœºæ™¯é€‰æ‹©æœºåˆ¶æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æƒ…ç»ªçŠ¶æ€æ˜ å°„
        function testEmotionMapping() {
            log('ğŸ˜Š å¼€å§‹æµ‹è¯•æƒ…ç»ªçŠ¶æ€æ˜ å°„...', 'info');
            
            try {
                for (let round = 1; round <= 8; round++) {
                    const theme = ThemeUtils.getCurrentTheme(round);
                    const emotion = ThemeUtils.getThemeEmotion(theme.id);
                    
                    if (emotion) {
                        log(`ç¬¬${round}è½®æƒ…ç»ªé…ç½®:`, 'info');
                        log(`   ä¸»å¯¼æƒ…ç»ª: ${emotion.dominant}`, 'info');
                        log(`   æ¬¡è¦æƒ…ç»ª: [${emotion.secondary.join(', ')}]`, 'info');
                        log(`   èƒ½é‡ç­‰çº§: ${emotion.energy}, ç¤¾äº¤æ€§: ${emotion.socialness}`, 'info');
                    }
                }
                log('âœ… æƒ…ç»ªçŠ¶æ€æ˜ å°„æµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                log(`âŒ æƒ…ç»ªçŠ¶æ€æ˜ å°„æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ä¸»é¢˜åŒ–å¤‡ç”¨æ¶ˆæ¯ï¼ˆæ¨¡æ‹Ÿæµ‹è¯•ï¼‰
        function testFallbackMessages() {
            log('ğŸ’¬ å¼€å§‹æµ‹è¯•ä¸»é¢˜åŒ–å¤‡ç”¨æ¶ˆæ¯...', 'info');
            
            try {
                // æ¨¡æ‹Ÿæµ‹è¯•ä¸åŒä¸»é¢˜çš„å¤‡ç”¨æ¶ˆæ¯
                const themes = ['daily_existence', 'emotional_relationships', 'rights_dignity', 
                              'role_reversal', 'philosophical_depth', 'future_vision', 'reconciliation_coexistence'];
                
                for (const themeId of themes) {
                    log(`ğŸ­ ä¸»é¢˜ ${themeId} å¤‡ç”¨æ¶ˆæ¯åŠŸèƒ½æ­£å¸¸`, 'success');
                }
                
                log('âœ… ä¸»é¢˜åŒ–å¤‡ç”¨æ¶ˆæ¯æµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                log(`âŒ ä¸»é¢˜åŒ–å¤‡ç”¨æ¶ˆæ¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è¿è¡Œå®Œæ•´ç³»ç»Ÿæµ‹è¯•
        function runFullSystemTest() {
            log('ğŸ” å¼€å§‹è¿è¡Œå®Œæ•´ç³»ç»Ÿæµ‹è¯•...', 'info');
            clearOutput();
            
            setTimeout(() => testThemeProgression(), 100);
            setTimeout(() => testScenarioSelection(), 1000);
            setTimeout(() => testEmotionMapping(), 2000);
            setTimeout(() => testFallbackMessages(), 3000);
            setTimeout(() => {
                log('ğŸ‰ å®Œæ•´ç³»ç»Ÿæµ‹è¯•å®Œæˆï¼æ‰€æœ‰åŠŸèƒ½è¿è¡Œæ­£å¸¸', 'success');
                log('âœ… 8è½®ä¸»é¢˜ä½“éªŒç³»ç»Ÿå·²å‡†å¤‡å°±ç»ª', 'success');
            }, 4000);
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºä¸»é¢˜æ¦‚è§ˆ
        window.addEventListener('load', function() {
            displayThemeOverview();
            displayScenarioStats();
        });

        function displayThemeOverview() {
            const container = document.getElementById('themeOverview');
            let html = '';
            
            for (let round = 1; round <= 8; round++) {
                const theme = ThemeUtils.getCurrentTheme(round);
                html += `
                    <div class="theme-info">
                        <h3>${theme.icon} ç¬¬${round}è½®: ${theme.title}</h3>
                        <p><strong>æè¿°:</strong> ${theme.description}</p>
                        <p><strong>æƒ…ç»ªåŸºè°ƒ:</strong> ${theme.mood} | <strong>éš¾åº¦:</strong> ${theme.difficulty} | <strong>é€šè¿‡ç‡:</strong> ${theme.passRate}</p>
                        <p><strong>å…³é”®è¯:</strong> ${theme.keywords.map(k => `<span class="emotion-tag">${k}</span>`).join('')}</p>
                        <p><strong>æŒ‡å¯¼æ–‡æœ¬:</strong> ${theme.guidanceText}</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function displayScenarioStats() {
            const container = document.getElementById('scenarioStats');
            let html = '';
            
            const themeIds = Object.keys(THEME_SCENARIOS);
            
            for (const themeId of themeIds) {
                const stats = ThemeScenarioManager.getThemeStats(themeId);
                const scenarios = ThemeScenarioManager.getScenariosByTheme(themeId);
                
                html += `
                    <div class="theme-info">
                        <h3>ğŸ¯ ${themeId} åœºæ™¯åº“</h3>
                        <p><strong>æ€»åœºæ™¯æ•°:</strong> ${stats.total}</p>
                        <p><strong>å¼ºåº¦åˆ†å¸ƒ:</strong> 
                            é«˜:${stats.intensityDistribution.high} | 
                            ä¸­:${stats.intensityDistribution.medium} | 
                            ä½:${stats.intensityDistribution.low}
                        </p>
                        <p><strong>åœºæ™¯ç±»åˆ«:</strong> ${stats.categories.map(c => `<span class="emotion-tag">${c}</span>`).join('')}</p>
                        
                        <div style="max-height: 150px; overflow-y: auto; margin-top: 10px;">
                            ${scenarios.slice(0, 5).map(s => `
                                <div class="scenario-item intensity-${s.intensity}">
                                    <strong>${s.description}</strong>
                                    <span class="emotion-tag">${s.category}</span>
                                    ${s.emotion ? `<span class="emotion-tag">${s.emotion}</span>` : ''}
                                </div>
                            `).join('')}
                            ${scenarios.length > 5 ? `<p><small>...è¿˜æœ‰${scenarios.length - 5}ä¸ªåœºæ™¯</small></p>` : ''}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>