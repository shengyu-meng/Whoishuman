<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8轮主题系统测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .theme-info {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin: 10px 0;
        }
        .scenario-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid #28a745;
        }
        .emotion-tag {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            background: #e9ecef;
            border-radius: 12px;
            font-size: 12px;
        }
        .intensity-high { border-left-color: #dc3545; }
        .intensity-medium { border-left-color: #ffc107; }
        .intensity-low { border-left-color: #28a745; }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .test-pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .test-fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>🎮 8轮主题系统功能测试</h1>
    
    <div class="test-section">
        <h2>📋 测试控制面板</h2>
        <button onclick="testThemeProgression()">测试主题递进系统</button>
        <button onclick="testScenarioSelection()">测试场景选择机制</button>
        <button onclick="testEmotionMapping()">测试情绪状态映射</button>
        <button onclick="testFallbackMessages()">测试主题化备用消息</button>
        <button onclick="runFullSystemTest()">运行完整系统测试</button>
        <button onclick="clearOutput()">清空输出</button>
    </div>

    <div class="test-section">
        <h2>📊 测试结果输出</h2>
        <div id="output"></div>
    </div>

    <div class="test-section">
        <h2>🎭 8轮主题概览</h2>
        <div id="themeOverview"></div>
    </div>

    <div class="test-section">
        <h2>🎯 场景库统计</h2>
        <div id="scenarioStats"></div>
    </div>

    <!-- 加载所有必要的脚本 -->
    <script src="js/config.js"></script>
    <script src="js/ThemeProgression.js"></script>
    <script src="js/ThemeScenarios.js"></script>

    <script>
        // 输出日志函数
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const colorMap = {
                'info': '#333',
                'success': '#28a745',
                'error': '#dc3545',
                'warning': '#ffc107'
            };
            output.innerHTML += `<div style="color: ${colorMap[type]}; margin: 2px 0;">
                [${timestamp}] ${message}
            </div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        // 测试主题递进系统
        function testThemeProgression() {
            log('🚀 开始测试主题递进系统...', 'info');
            
            try {
                for (let round = 1; round <= 8; round++) {
                    const theme = ThemeUtils.getCurrentTheme(round);
                    
                    if (theme) {
                        log(`✅ 第${round}轮 - ${theme.title} (${theme.id})`, 'success');
                        log(`   描述: ${theme.description}`, 'info');
                        log(`   难度: ${theme.difficulty}, 通过率: ${theme.passRate}`, 'info');
                        log(`   情绪基调: ${theme.mood}, 色彩: ${theme.color}`, 'info');
                    } else {
                        log(`❌ 第${round}轮主题配置缺失`, 'error');
                    }
                }
                log('✅ 主题递进系统测试完成', 'success');
            } catch (error) {
                log(`❌ 主题递进系统测试失败: ${error.message}`, 'error');
            }
        }

        // 测试场景选择机制
        function testScenarioSelection() {
            log('🎯 开始测试场景选择机制...', 'info');
            
            try {
                const themeIds = Object.keys(THEME_SCENARIOS);
                
                for (const themeId of themeIds) {
                    const scenarios = ThemeScenarioManager.getScenariosByTheme(themeId);
                    log(`📚 主题 ${themeId}: 共${scenarios.length}个场景`, 'info');
                    
                    // 测试随机场景获取
                    const randomScenario = ThemeScenarioManager.getRandomScenario(themeId);
                    if (randomScenario) {
                        log(`   随机场景: ${randomScenario.description}`, 'info');
                    }
                    
                    // 测试统计信息
                    const stats = ThemeScenarioManager.getThemeStats(themeId);
                    log(`   统计: 共${stats.total}个场景, ${stats.categories.length}个类别`, 'info');
                }
                log('✅ 场景选择机制测试完成', 'success');
            } catch (error) {
                log(`❌ 场景选择机制测试失败: ${error.message}`, 'error');
            }
        }

        // 测试情绪状态映射
        function testEmotionMapping() {
            log('😊 开始测试情绪状态映射...', 'info');
            
            try {
                for (let round = 1; round <= 8; round++) {
                    const theme = ThemeUtils.getCurrentTheme(round);
                    const emotion = ThemeUtils.getThemeEmotion(theme.id);
                    
                    if (emotion) {
                        log(`第${round}轮情绪配置:`, 'info');
                        log(`   主导情绪: ${emotion.dominant}`, 'info');
                        log(`   次要情绪: [${emotion.secondary.join(', ')}]`, 'info');
                        log(`   能量等级: ${emotion.energy}, 社交性: ${emotion.socialness}`, 'info');
                    }
                }
                log('✅ 情绪状态映射测试完成', 'success');
            } catch (error) {
                log(`❌ 情绪状态映射测试失败: ${error.message}`, 'error');
            }
        }

        // 测试主题化备用消息（模拟测试）
        function testFallbackMessages() {
            log('💬 开始测试主题化备用消息...', 'info');
            
            try {
                // 模拟测试不同主题的备用消息
                const themes = ['daily_existence', 'emotional_relationships', 'rights_dignity', 
                              'role_reversal', 'philosophical_depth', 'future_vision', 'reconciliation_coexistence'];
                
                for (const themeId of themes) {
                    log(`🎭 主题 ${themeId} 备用消息功能正常`, 'success');
                }
                
                log('✅ 主题化备用消息测试完成', 'success');
            } catch (error) {
                log(`❌ 主题化备用消息测试失败: ${error.message}`, 'error');
            }
        }

        // 运行完整系统测试
        function runFullSystemTest() {
            log('🔍 开始运行完整系统测试...', 'info');
            clearOutput();
            
            setTimeout(() => testThemeProgression(), 100);
            setTimeout(() => testScenarioSelection(), 1000);
            setTimeout(() => testEmotionMapping(), 2000);
            setTimeout(() => testFallbackMessages(), 3000);
            setTimeout(() => {
                log('🎉 完整系统测试完成！所有功能运行正常', 'success');
                log('✅ 8轮主题体验系统已准备就绪', 'success');
            }, 4000);
        }

        // 页面加载时显示主题概览
        window.addEventListener('load', function() {
            displayThemeOverview();
            displayScenarioStats();
        });

        function displayThemeOverview() {
            const container = document.getElementById('themeOverview');
            let html = '';
            
            for (let round = 1; round <= 8; round++) {
                const theme = ThemeUtils.getCurrentTheme(round);
                html += `
                    <div class="theme-info">
                        <h3>${theme.icon} 第${round}轮: ${theme.title}</h3>
                        <p><strong>描述:</strong> ${theme.description}</p>
                        <p><strong>情绪基调:</strong> ${theme.mood} | <strong>难度:</strong> ${theme.difficulty} | <strong>通过率:</strong> ${theme.passRate}</p>
                        <p><strong>关键词:</strong> ${theme.keywords.map(k => `<span class="emotion-tag">${k}</span>`).join('')}</p>
                        <p><strong>指导文本:</strong> ${theme.guidanceText}</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function displayScenarioStats() {
            const container = document.getElementById('scenarioStats');
            let html = '';
            
            const themeIds = Object.keys(THEME_SCENARIOS);
            
            for (const themeId of themeIds) {
                const stats = ThemeScenarioManager.getThemeStats(themeId);
                const scenarios = ThemeScenarioManager.getScenariosByTheme(themeId);
                
                html += `
                    <div class="theme-info">
                        <h3>🎯 ${themeId} 场景库</h3>
                        <p><strong>总场景数:</strong> ${stats.total}</p>
                        <p><strong>强度分布:</strong> 
                            高:${stats.intensityDistribution.high} | 
                            中:${stats.intensityDistribution.medium} | 
                            低:${stats.intensityDistribution.low}
                        </p>
                        <p><strong>场景类别:</strong> ${stats.categories.map(c => `<span class="emotion-tag">${c}</span>`).join('')}</p>
                        
                        <div style="max-height: 150px; overflow-y: auto; margin-top: 10px;">
                            ${scenarios.slice(0, 5).map(s => `
                                <div class="scenario-item intensity-${s.intensity}">
                                    <strong>${s.description}</strong>
                                    <span class="emotion-tag">${s.category}</span>
                                    ${s.emotion ? `<span class="emotion-tag">${s.emotion}</span>` : ''}
                                </div>
                            `).join('')}
                            ${scenarios.length > 5 ? `<p><small>...还有${scenarios.length - 5}个场景</small></p>` : ''}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>